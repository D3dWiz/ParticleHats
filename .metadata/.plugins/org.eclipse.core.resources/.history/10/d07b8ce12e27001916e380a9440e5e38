package com.mediusecho.particlehats.editor.menus;

import java.util.Arrays;

import org.bukkit.Bukkit;
import org.bukkit.Material;
import org.bukkit.entity.Player;
import org.bukkit.inventory.ItemStack;

import com.mediusecho.particlehats.Core;
import com.mediusecho.particlehats.editor.EditorMenu;
import com.mediusecho.particlehats.editor.MenuBuilder;
import com.mediusecho.particlehats.locale.Message;
import com.mediusecho.particlehats.util.ItemUtil;

public class EditorSlotMenu extends EditorMenu {

	public EditorSlotMenu(Core core, Player owner, MenuBuilder menuBuilder) 
	{
		super(core, owner, menuBuilder, true);
		
		inventory = Bukkit.createInventory(null, menuBuilder.getEditingMenu().getInventory().getSize(), Message.EDITOR_SLOT_MENU_TITlE.getValue());
		buildMenu();
	}

	@Override
	protected void buildMenu() 
	{
		EditorBaseMenu editorBaseMenu = menuBuilder.getEditingMenu();
		int targetSlot = menuBuilder.getTargetSlot();
		inventory.setContents(editorBaseMenu.getInventory().getContents());
		
		final EditorAction cancelAction = (event, slot) ->
		{
			menuBuilder.goBack();
			return true;
		};
		
		final EditorAction selectAction = (event, slot) ->
		{
			editorBaseMenu.changeSlots(menuBuilder.getTargetSlot(), slot, false);
			menuBuilder.goBack();
			return true;
		};
		
		final EditorAction swapAction = (event, slot) ->
		{
			editorBaseMenu.changeSlots(menuBuilder.getTargetSlot(), slot, true);
			menuBuilder.goBack();
			return true;
		};
		
		for (int i = 0; i < inventory.getSize(); i++)
		{
			ItemStack item = inventory.getItem(i);
			if (item == null) {
				item = ItemUtil.createItem(Material.LIGHT_GRAY_STAINED_GLASS_PANE, Message.EDITOR_SLOT_MENU_SELECT);
			}
			
			String displayName = Message.EDITOR_SLOT_MENU_SELECT.getValue();
			if (i  == targetSlot) 
			{
				ItemUtil.highlightItem(item);
				displayName = Message.EDITOR_SLOT_MENU_CANCEL.getValue();
				setAction(i, cancelAction);
			}
			
			else if (editorBaseMenu.getHat(i) != null)
			{
				displayName = Message.EDITOR_SLOT_MENU_SWAP.getValue();
				setAction(i, swapAction);
			}
			
			else {
				setAction(i, selectAction);
			}
			
			ItemUtil.setItemName(item, displayName);
			ItemUtil.setItemDescription(item, Arrays.asList());
		}
	}

}
