package com.mediusecho.particlehats.editor;

import java.text.DecimalFormat;

import org.bukkit.Sound;
import org.bukkit.inventory.ItemStack;
import org.bukkit.util.Vector;

import com.mediusecho.particlehats.locale.Message;
import com.mediusecho.particlehats.managers.SettingsManager;
import com.mediusecho.particlehats.particles.Hat;
import com.mediusecho.particlehats.particles.properties.ParticleAction;
import com.mediusecho.particlehats.particles.properties.ParticleLocation;
import com.mediusecho.particlehats.particles.properties.ParticleMode;
import com.mediusecho.particlehats.util.ItemUtil;
import com.mediusecho.particlehats.util.MathUtil;
import com.mediusecho.particlehats.util.StringUtil;

public class EditorLore {

	/**
	 * Applies a description to this ItemStack using ParticleLocation data
	 * @param item
	 * @param location
	 * @param description
	 */
	public static void updateLocationDescription (ItemStack item, ParticleLocation location, Message description)
	{
		if (item != null)
		{
			final int length = ParticleLocation.values().length;
			final int id = location.getID();
			
			String s = description.getValue()
					.replace("{1}", ParticleLocation.fromId(MathUtil.wrap(id - 1, length, 0)).getDisplayName())
					.replace("{2}", location.getDisplayName())
					.replace("{3}", ParticleLocation.fromId(MathUtil.wrap(id + 1, length, 0)).getDisplayName());
			ItemUtil.setItemDescription(item, StringUtil.parseDescription(s));		
		}
	}
	
	/**
	 * Applies a descriptin to this ItemStack using ParticleMode data
	 * @param item
	 * @param mode
	 * @param description
	 */
	public static void updateModeDescription (ItemStack item, ParticleMode mode, Message description)
	{
		if (item != null)
		{
			final int length = ParticleMode.values().length;
			final int id = mode.getID();
			
			String s = description.getValue()
					.replace("{1}", ParticleMode.fromId(MathUtil.wrap(id - 1, length, 0)).getDisplayName())
					.replace("{2}", mode.getDisplayName())
					.replace("{3}", ParticleMode.fromId(MathUtil.wrap(id + 1, length, 0)).getDisplayName())
					.replace("{4}", mode.getDescription());
			ItemUtil.setItemDescription(item, StringUtil.parseDescription(s));		
		}
	}
	
	/**
	 * Applies a description to this ItemStack using Vector data
	 * @param item
	 * @param hat
	 * @param description
	 */
	public static void updateVectorDescription (ItemStack item, Vector vector, Message description)
	{
		if (item != null)
		{
			String s = description.getValue()
				.replace("{1}", Double.toString(vector.getX()))
				.replace("{2}", Double.toString(vector.getY()))
				.replace("{3}", Double.toString(vector.getZ()));
			ItemUtil.setItemDescription(item, StringUtil.parseDescription(s));
		}
	}
	
	/**
	 * Applies a description to this ItemStack using UpdateFrequency data (int)
	 * @param item
	 * @param updateFrequency
	 * @param description
	 */
	public static void updateFrequencyDescription (ItemStack item, int updateFrequency, Message description)
	{
		if (item != null)
		{
			String pluralSuffix = StringUtil.getParseValue(description.getValue(), "2");
			String suffix = updateFrequency > 1 && pluralSuffix != null ? pluralSuffix : "";
			String s = description.getValue()
					.replace("{1}", Integer.toString(updateFrequency))
					.replaceAll("\\{2.*\\}", suffix);
			ItemUtil.setItemDescription(item, StringUtil.parseDescription(s));
		}
	}
	
	/**
	 * Applies a description to this ItemStack using a price value
	 * @param item
	 * @param price
	 * @param description
	 */
	public static void updatePriceDescription (ItemStack item, int price, Message description)
	{
		if (item != null)
		{
			String[] priceData = StringUtil.parseValue(description.getValue(), "1");
			String c = price > 0 ?  StringUtil.escapeSpecialCharacters(SettingsManager.CURRENCY.getString()) : "";
			
			String s;
			if (priceData != null) 
			{
				s = description.getValue()
						.replace(priceData[0], price == 0 ? priceData[1] : Integer.toString(price))
						.replace("{2}", c);
			}
			
			else {
				s = description.getValue()
						.replace("{1}", Integer.toString(price))
						.replace("{2}", c);
			}
			
			ItemUtil.setItemDescription(item, StringUtil.parseDescription(s));
			
//			String suffix = StringUtil.getParseValue(description.getValue(), "1");
//			String p = price == 0 && suffix != null ? suffix : Integer.toString(price);
//			String c = price > 0 ?  StringUtil.escapeSpecialCharacters(SettingsManager.CURRENCY.getString()) : "";
//			
//			String s = description.getValue()
//					.replace("{2}", c)
//					.replaceAll("\\{1.*\\}", p);
//			ItemUtil.setItemDescription(item, StringUtil.parseDescription(s));
		}
	}
	
	/**
	 * Applies a description to this ItemStack using an int
	 * @param item
	 * @param speed
	 * @param description
	 */
	public static void updateIntegerDescription (ItemStack item, int value, Message description)
	{
		if (item != null)
		{
			String s = description.getValue()
					.replace("{1}", Integer.toString(value));
			ItemUtil.setItemDescription(item, StringUtil.parseDescription(s));
		}
	}
	
	/**
	 * Applies a description to this ItemStack using an int
	 * @param item
	 * @param speed
	 * @param description
	 */
	public static void updateDoubleDescription (ItemStack item, double value, Message description)
	{
		if (item != null)
		{
			String s = description.getValue()
					.replace("{1}", Double.toString(value));
			ItemUtil.setItemDescription(item, StringUtil.parseDescription(s));
		}
	}
	
	/**
	 * Applies a description to this ItemStack using Sound data
	 * @param item
	 * @param sound
	 * @param currentSound
	 * @param description
	 */
	public static void updateSoundDescription (ItemStack item, Sound sound, Sound currentSound, Message description)
	{
		String[] selectedParse = StringUtil.parseValue(description.getValue(), "1");
		if (selectedParse != null)
		{
			String selectedSuffix = (currentSound != null && currentSound.equals(sound)) ? selectedParse[1] : "";
			String s = description.getValue()
					.replace(selectedParse[0], selectedSuffix);
			ItemUtil.setItemDescription(item, StringUtil.parseDescription(s));
		}
	}
	
	public static void updateSpecificActionDescription (ItemStack item, Hat hat, ParticleAction action, String argument)
	{
		String description = Message.EDITOR_ACTION_OVERVIEW_MENU_ACTION_DESCRIPTION.getValue();

		//"/n&8Current:/n{2=/n/n}/n/n&3Left Click to Change Action/n&cRight Click to Change {3}"
//		String[] actionInfo = StringUtil.parseValue(description, "1");
//		if (actionInfo != null)
//		{
			String actionDescription = getParsedActionDescription(hat, action, argument);
			description.replace("{1}", actionDescription);
		//}
		ItemUtil.setItemDescription(item, StringUtil.parseDescription(description));
	}
	
	/**
	 * Applies a description to this ItemStack using ParticleAction data
	 * @param item
	 * @param hat
	 */
	public static void updateGenericActionDescription (ItemStack item, Hat hat)
	{
		ParticleAction leftClickAction  = hat.getLeftClickAction();
		ParticleAction rightClickAction = hat.getRightClickAction();
		
		String leftClickDescription = getParsedActionDescription(hat, leftClickAction, hat.getLeftClickArgument());
		String rightClickDescription = getParsedActionDescription(hat, rightClickAction, hat.getRightClickArgument());
		
		//"/n&8Left Click Action:/n{1}/n/n&8Right Click Action:/n{2}/n/n&3Click to Change Actions"
		String description = Message.EDITOR_MAIN_MENU_ACTION_DESCRIPTION.getValue();
		description = description
				.replace("{1}", leftClickDescription)
				.replace("{2}", rightClickDescription);
		ItemUtil.setItemDescription(item, StringUtil.parseDescription(description));
	}
	
	private static String getParsedActionDescription (Hat hat, ParticleAction action, String argument)
	{
		switch (action)
		{
		case OPEN_MENU_PERMISSION:
		case OPEN_MENU:
		{
			//&8Will Open Menu:/n&8» {1=&cNot Set}
			String description = Message.EDITOR_ACTION_MENU_MENU_DESCRIPTION.getValue();
			String[] menuInfo = StringUtil.parseValue(description, "2");
			
			description = description.replace("{1}", action.getDisplayName());
			if (menuInfo != null)
			{
				if (argument.equals("")) {
					description = description.replace(menuInfo[0], menuInfo[1]);
				} else {
					description = description.replace(menuInfo[0], argument);
				}
			}
			
			return description;
		}
			
		case COMMAND:
		{
			//&8Executes Command:/n&8» {1=&cNot Set}
			String description = Message.EDITOR_ACTION_MENU_COMMAND_DESCRIPTION.getValue();
			String[] commandInfo = StringUtil.parseValue(description, "2");
			
			description = description.replace("{1}", action.getDisplayName());
			if (commandInfo != null)
			{
				if (argument.equals("")) {
					description = description.replace(commandInfo[0], commandInfo[1]);
				} else  {
					description = description.replace(commandInfo[0], "/" + argument);
				}
			}
			return description;
		}
			
		case DEMO:
		{
			//&8Duration:/n&8» &7{1} second{2=s}
			String description = Message.EDITOR_ACTION_MENU_DEMO_DESCRIPTION.getValue();
			String[] suffixInfo = StringUtil.parseValue(description, "3");
			
			DecimalFormat df = new DecimalFormat("#.#");
			int duration = hat.getDemoDuration();
			double time = duration / 20D;
			
			description = description.replace("{1}", action.getDisplayName());
			if (suffixInfo != null)
			{
				String suffix = time == 1 ? "" : suffixInfo[1];
				description = description.replace(suffixInfo[0], suffix);
			}
			
			description = description.replace("{2}", df.format(time));
			return description;
		}
		
		default:
		{
			///n&8Current:/n&8» &7{1}
			String description = Message.EDITOR_ACTION_MENU_MISC_DESCRIPTION.getValue();
			description = description.replace("{1}", action.getDisplayName());
			return description;
		}
		}
	}
}
